<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="koing.kosta180.mapper.CommentMapper">
	<insert id="insertComment" parameterType="CommentVO">
		insert into comments(c_no, c_contents, c_score, c_img, r_no, id, s_no)
		values(c_no_seq.nextval, #{c_contents}, #{c_score}, #{c_img},
		#{r_no}, #{id}, #{s_no})
	</insert>

	<select id="listComment" parameterType="String" resultType="CommentVO">
		select * from comments where s_no = #{s_no}
	</select>

	<select id="getComment" parameterType="String" resultType="CommentVO">
		select * from comments where c_no = #{c_no}
	</select>

	<update id="updateComment" parameterType="CommentVO">
		update comments set c_contents = #{c_contents}, c_img = #{c_img}, c_score =
		#{c_score} where c_no =
		#{c_no}
	</update>
	<delete id="deleteComment" parameterType="String">
		delete from comments where c_no = #{c_no}
	</delete>

	<select id="listPage" resultType="CommentVO">
	
		<!--   <![CDATA[
		 select 
		  c_no, c_contents, c_score, c_img, r_no, id, s_no
		 from
		   (
		   select /*+INDEX_DESC(comments COMMENTS_CNO_PK))*/
		     rownum rn, c_no, c_contents, c_score, c_img, tr_no, id, s_no
		   from comments
		   where s_no = #{s_no}
		   and c_no > 0
		   and rownum <= #{cri.page} * #{cri.perPageNum}
		   )
		where rn > ( #{cri.page} -1) * #{cri.perPageNum}
	  ]]> -->

	<![CDATA[
		select c_no, c_contents, c_score, c_img, r_no, id, s_no, c_date
		from (select rownum rn, c_no, c_contents, c_score, c_img, r.r_no as r_no,id, s_no, c_date
					from reservation r, comments c
					where r.r_no = c.r_no and s_no = #{s_no} and rownum <= #{cri.page} * #{cri.perPageNum})
		where rn > ( #{cri.page} -1) * #{cri.perPageNum}
		order by c_date desc ,c_no desc;
	]]>
	</select>

	<select id="count" resultType="int">
		select count(s_no) from comments
		where s_no =#{s_no}
	</select>
<!-- 
 -->
</mapper>